<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Job Lead to Airtable - Settings</title>
  <link rel="stylesheet" href="options.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>Job Lead to Airtable</h1>
      <p class="subtitle">Configure your Airtable connection</p>
    </header>

    <main>
      <form id="settingsForm">
        <div class="form-group">
          <label for="apiKey">
            Airtable API Key (Personal Access Token)
            <span class="help-icon" title="Get this from Airtable account settings">?</span>
          </label>
          <input
            type="password"
            id="apiKey"
            name="apiKey"
            placeholder="pat********************"
            required
          >
          <small class="help-text">
            Create a token at <a href="https://airtable.com/create/tokens" target="_blank">airtable.com/create/tokens</a>
          </small>
        </div>

        <div class="form-group">
          <label for="baseId">
            Base ID
            <span class="help-icon" title="Find this in your Airtable base URL">?</span>
          </label>
          <input
            type="text"
            id="baseId"
            name="baseId"
            placeholder="app****************"
            required
            pattern="app[a-zA-Z0-9]{14}"
          >
          <small class="help-text">
            Found in your base URL: airtable.com/<strong>appXXXXXXXXXXXXXX</strong>/...
          </small>
        </div>

        <div class="form-group">
          <label for="tableName">
            Table Name
            <span class="help-icon" title="Exact name of your Airtable table">?</span>
          </label>
          <input
            type="text"
            id="tableName"
            name="tableName"
            placeholder="Job Leads"
            required
          >
          <small class="help-text">
            The exact name of your table (case-sensitive)
          </small>
        </div>

        <div class="form-group">
          <label>
            <input type="checkbox" id="showApiKey"> Show API Key
          </label>
        </div>

        <div class="button-group">
          <button type="button" id="testButton" class="button button-secondary">
            Test Connection
          </button>
          <button type="submit" class="button button-primary">
            Save Settings
          </button>
        </div>
      </form>

      <div id="status" class="status hidden"></div>

      <section class="info-section">
        <h2>Field Requirements</h2>
        <p>Your Airtable table must have these fields (names must match exactly):</p>
        <ul>
          <li><strong>Company</strong> - Single line text (required)</li>
          <li><strong>Title</strong> - Single line text (required)</li>
          <li><strong>Location</strong> - Single line text (required)</li>
          <li><strong>Status</strong> - Single line text (auto-set to "New")</li>
          <li><strong>Last Updated</strong> - Single line text (auto-filled with timestamp)</li>
          <li><strong>Score</strong> - Number (auto-set to 0)</li>
          <li><strong>Source</strong> - Single line text (auto-set to "Browser")</li>
          <li><strong>Link</strong> - URL (auto-filled with job posting URL)</li>
          <li><strong>Summary</strong> - Long text (optional, for job descriptions)</li>
        </ul>
        <p class="note">Field names are case-sensitive!</p>
      </section>

      <section class="info-section">
        <h2>How to Use</h2>
        <ol>
          <li>Save your Airtable credentials above</li>
          <li>Navigate to any job posting website</li>
          <li>Click the extension icon in your toolbar</li>
          <li>Review the detected job data</li>
          <li>Click "Send to Airtable" to save</li>
        </ol>
      </section>

      <section class="info-section draft-section">
        <div class="section-header">
          <h2>Saved Drafts</h2>
          <button type="button" id="refreshDraftsButton" class="button button-small button-secondary">
            Refresh
          </button>
        </div>
        <p>Auto-saved form data from job postings you've started filling out.</p>

        <div id="draftStats" class="draft-stats">
          <span id="draftCount">Loading...</span>
        </div>

        <div id="draftList" class="draft-list">
          <!-- Draft items will be inserted here -->
        </div>

        <div class="draft-actions">
          <button type="button" id="clearAllDraftsButton" class="button button-secondary">
            Clear All Drafts
          </button>
          <button type="button" id="cleanupOldDraftsButton" class="button button-secondary">
            Cleanup Old Drafts (30+ days)
          </button>
        </div>
      </section>
    </main>

    <footer>
      <p>Job Lead to Airtable v1.3.2</p>
    </footer>
  </div>

  <script src="../utils/draft-storage.js"></script>
  <script src="../utils/storage.js"></script>
  <script src="../utils/airtable.js"></script>
  <script src="options.js"></script>
</body>
</html>
